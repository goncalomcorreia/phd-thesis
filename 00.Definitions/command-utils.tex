\newcommand{\smap}{SparseMAP\xspace}
\newcommand*{\wrt}{\textit{w.\hspace{.07em}r\hspace{.07em}.t.}\@\xspace}
\newcommand*{\eg}{\textit{e.\hspace{.07em}g.}\@\xspace}
\newcommand*{\ie}{\textit{i.\hspace{.07em}e.}\@\xspace}
\newcommand*{\cf}{\textit{cf.}\@\xspace}
\newcommand*{\lhs}{\textit{l.\hspace{.07em}h\hspace{.07em}.s.}\@\xspace}
\newcommand*{\rhs}{\textit{r.\hspace{.07em}h\hspace{.07em}.s.}\@\xspace}
\newcommand{\eqnref}[1]{Equation~\ref{#1}}
\newcommand{\chapref}[1]{Chapter~\ref{#1}}
\newcommand{\secref}[1]{\S\ref{#1}}
\newcommand{\figref}[1]{Figure~\ref{#1}}
\newcommand{\tableref}[1]{Table~\ref{#1}}
\newcommand{\appref}[1]{Appendix~\ref{#1}}

% font for small caps
% \newcommand*{\fonttextsc}{\fontfamily{lmtt}\selectfont}

\let\log\relax
\let\exp\relax
\let\min\relax
\let\max\relax
\DeclareMathOperator*{\log}{\mathsf{log}}
\DeclareMathOperator*{\exp}{\mathsf{exp}}
\DeclareMathOperator*{\min}{\mathsf{min}}
\DeclareMathOperator*{\max}{\mathsf{max}}
\DeclareMathOperator{\KL}{\mathsf{KL}}
\DeclareMathOperator{\Bern}{\mathsf{Bernoulli}}
\DeclareMathOperator{\Cat}{\mathsf{Categorical}}
\DeclareMathOperator{\Gibbs}{\mathsf{Gibbs}}
\DeclareMathOperator{\supp}{\mathsf{supp}}
\DeclareMathOperator*{\sigmoid}{\mathsf{sigmoid}}
\DeclareMathOperator*{\softmax}{\mathsf{softmax}}
\DeclareMathOperator*{\smapop}{\mathsf{SparseMAP}}
\DeclareMathOperator*{\sparsemax}{\mathsf{sparsemax}}
\DeclareMathOperator*{\argmin}{\mathsf{argmin}}
\DeclareMathOperator*{\argmax}{\mathsf{argmax}}
\DeclareMathOperator*{\minimize}{\mathsf{minimize}}
\DeclareMathOperator*{\maximize}{\mathsf{maximize}}
\DeclareMathOperator*{\subjto}{\mathsf{s.t.}}
\DeclareMathOperator{\sparsemaxk}{\mathsf{sparsemax}_\text{$k$}}
\DeclareMathOperator{\topk}{\mathsf{top}_\text{$k$}}
\DeclareMathOperator{\att}{\mathsf{Att}}
\DeclareMathOperator{\ath}{\mathsf{Head}}
\DeclareMathOperator*{\diag}{\mathsf{diag}}
\DeclareMathOperator*{\entmax}{\mathsf{\entmaxtext}}
\newcommand{\simplex}{\triangle}
\renewcommand\ss{s}
\newcommand\s{\bm{\ss}}
\newcommand\xx{z}
\newcommand\x{\bm{\xx}}
\newcommand{\reals}{\mathbb{R}}
\newcommand\zrv{Z}
\newcommand\ZZ{\mathcal{Z}}
\newcommand\LL{\mathcal{L}}
\renewcommand\AA{\bm{A}}
\newcommand\zsamp{z}
\newcommand\defeq\coloneqq
\newcommand\pv{\bm{\xi}}
\newcommand\g{\bm{g}}
\newcommand\dd{\operatorname{d}\!}
\newcommand\pp{p}
\newcommand\p{\bm{\pp}}
\newcommand\thresh{\tau}
\newcommand*\entmaxtext{entmax\xspace}
\newcommand*\aentmax[1][\alpha]{\mathop{\mathsf{#1}\textnormal{-}\mathsf{\entmaxtext}}}

% \newtheorem{definition}{Definition}
% \newtheorem{proposition}{Proposition}
% \newtheorem{lemma}{Lemma}
% \newtheorem{corollary}{Corollary}[lemma]

\newcommand{\delang}{{\textsc{de}}\xspace}
\newcommand{\enlang}{{\textsc{en}}\xspace}
\newcommand{\rolang}{{\textsc{ro}}\xspace}
\newcommand{\jalang}{{\textsc{ja}}\xspace}
\newcommand{\langp}[2]{{\textsc{#1}}$\shortrightarrow${\textsc{#2}}}
\newcommand{\langpb}[2]{{\textsc{#1}}$\leftrightarrow${\textsc{#2}}}
\newcommand{\tr}{\top}
\newcommand{\amap}{\bm{\pi}}
\newcommand{\HHs}{\mathsf{H}^{\textsc{S}}}
\newcommand{\HHt}{\mathsf{H}^{{\textsc{T}}}}
\newcommand{\ones}{\bm{1}}
\newcommand{\EE}{\mathbb{E}}
\newcommand{\RR}{\mathbb{R}}
\newcommand{\param}{{\bm{\theta}}}
\newcommand*\diff{\mathop{}\!\mathrm{d}}

\newcommand{\DP}[2]{\langle#1,#2\rangle}
\newcommand{\pfrac}[2]{\frac{\partial #1}{\partial #2}}
\newcommand\spacerule{\addlinespace[0.33em]}

\newenvironment{itemizesquish}
{\begin{list}{\labelitemi}
                {\setlength{\itemsep}{0em}\setlength{\labelwidth}
                        {0.5em}\setlength{\leftmargin}
                        {\labelwidth}\addtolength{\leftmargin}
                        {\labelsep}}}{\end{list}}
\newenvironment{enumeratesquish}
{\begin{list}{\addtocounter{enumi}{1}\labelenumi}
                {\setlength{\itemsep}{0em}\setlength{\labelwidth}
                        {0.5em}\setlength{\leftmargin}
                        {\labelwidth}\addtolength{\leftmargin}
                        {\labelsep}}}{\end{list}\setcounter{enumi}{0}}

\newcommand{\textover}[3][l]{%
        % #1 is the alignment, default l
        % #2 is the text to be printed
        % #3 is the text for setting the width
        \makebox[\widthof{#3}][#1]{#2}%
}

\newcounter{definition}[section]
\newenvironment{definition}[1][]{%
        \stepcounter{definition}%
        \ifstrempty{#1}%
        {\mdfsetup{%
                        frametitle={%
                                        \tikz[baseline=(current bounding box.east),inner xsep = 5mm,inner ysep=1mm]
                                        \node[anchor=east,rectangle,fill=defineblue]
                                        {\strut Definition~\thedefinition};}}
        }%
        {\mdfsetup{%
                        frametitle={%
                                        \tikz[baseline=(current bounding box.east),inner xsep = 5mm,inner ysep=1mm]
                                        \node[anchor=east,rectangle,fill=defineblue]
                                        {\strut Definition~\thedefinition:~#1};}}%
        }%
        \mdfsetup{innertopmargin=10pt,linecolor=defineblue,%
                linewidth=2pt,topline=true,
                frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
        \begin{mdframed}[]\relax%
                }{\end{mdframed}}
\mdfsetup{skipabove=\topskip,skipbelow=\topskip}

\newcounter{lemma}[section]
\newenvironment{lemma}[1][]{%
        \stepcounter{lemma}%
        \ifstrempty{#1}%
        {\mdfsetup{%
                        frametitle={%
                                        \tikz[baseline=(current bounding box.east),inner xsep = 5mm,inner ysep=1mm]
                                        \node[anchor=east,rectangle,fill=lemmayellow]
                                        {\strut Lemma~\thelemma};}}
        }%
        {\mdfsetup{%
                        frametitle={%
                                        \tikz[baseline=(current bounding box.east),inner xsep = 5mm,inner ysep=1mm]
                                        \node[anchor=east,rectangle,fill=lemmayellow]
                                        {\strut Lemma~\thelemma:~#1};}}%
        }%
        \mdfsetup{innertopmargin=10pt,linecolor=lemmayellow,%
                linewidth=2pt,topline=true,
                frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
        \begin{mdframed}[]\relax%
                }{\end{mdframed}}
\mdfsetup{skipabove=\topskip,skipbelow=\topskip}

\newcounter{proposition}[section]
\newenvironment{proposition}[1][]{%
        \stepcounter{proposition}%
        \ifstrempty{#1}%
        {\mdfsetup{%
                        frametitle={%
                                        \tikz[baseline=(current bounding box.east),inner xsep = 5mm,inner ysep=1mm]
                                        \node[anchor=east,rectangle,fill=propositionmint]
                                        {\strut Proposition~\theproposition};}}
        }%
        {\mdfsetup{%
                        frametitle={%
                                        \tikz[baseline=(current bounding box.east),inner xsep = 5mm,inner ysep=1mm]
                                        \node[anchor=east,rectangle,fill=propositionmint]
                                        {\strut Proposition~\theproposition:~#1};}}%
        }%
        \mdfsetup{innertopmargin=10pt,linecolor=propositionmint,%
                linewidth=2pt,topline=true,
                frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
        \begin{mdframed}[]\relax%
                }{\end{mdframed}}
\mdfsetup{skipabove=\topskip,skipbelow=\topskip}
